---
// Savings Goal Calculator Component
---

<div class="savings-goal-calculator max-w-4xl mx-auto">
  <!-- Calculator Form -->
  <div class="bg-gray-50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-800 rounded-2xl p-8 mb-8">
    <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">Calculate Your Savings Goal</h3>
    
    <div class="space-y-6">
      <!-- Target Amount -->
      <div>
        <label for="target-amount" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          Target Savings Goal
        </label>
        <div class="relative">
          <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-600 dark:text-gray-400">$</span>
          <input
            type="number"
            id="target-amount"
            class="w-full pl-8 pr-4 py-3 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:border-green-600 focus:ring-1 focus:ring-green-600 transition-colors"
            placeholder="10000"
            min="0"
            step="0.01"
          />
        </div>
      </div>

      <!-- Current Savings -->
      <div>
        <label for="current-savings" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          Current Savings
        </label>
        <div class="relative">
          <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-600 dark:text-gray-400">$</span>
          <input
            type="number"
            id="current-savings"
            class="w-full pl-8 pr-4 py-3 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:border-green-600 focus:ring-1 focus:ring-green-600 transition-colors"
            placeholder="0"
            min="0"
            step="0.01"
            value="0"
          />
        </div>
      </div>

      <!-- Mode Selection -->
      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          Calculate By
        </label>
        <div class="grid grid-cols-2 gap-3">
          <button
            type="button"
            id="mode-timeline"
            class="calc-mode-btn px-4 py-3 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg text-gray-900 dark:text-white hover:border-green-600 transition-colors"
            data-mode="timeline"
          >
            Monthly Contribution
          </button>
          <button
            type="button"
            id="mode-contribution"
            class="calc-mode-btn px-4 py-3 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg text-gray-900 dark:text-white hover:border-green-600 transition-colors"
            data-mode="contribution"
          >
            Target Timeline
          </button>
        </div>
      </div>

      <!-- Monthly Contribution (if mode is timeline) -->
      <div id="monthly-contribution-group">
        <label for="monthly-contribution" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          Monthly Contribution
        </label>
        <div class="relative">
          <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-600 dark:text-gray-400">$</span>
          <input
            type="number"
            id="monthly-contribution"
            class="w-full pl-8 pr-4 py-3 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:border-green-600 focus:ring-1 focus:ring-green-600 transition-colors"
            placeholder="500"
            min="0"
            step="0.01"
          />
        </div>
      </div>

      <!-- Target Timeline (if mode is contribution) -->
      <div id="target-timeline-group" class="hidden">
        <label for="target-months" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          Target Timeline (Months)
        </label>
        <input
          type="number"
          id="target-months"
          class="w-full px-4 py-3 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:border-green-600 focus:ring-1 focus:ring-green-600 transition-colors"
          placeholder="24"
          min="1"
          step="1"
        />
      </div>

      <!-- Interest Rate -->
      <div>
        <label for="interest-rate" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          Annual Interest Rate (%)
        </label>
        <input
          type="number"
          id="interest-rate"
          class="w-full px-4 py-3 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:border-green-600 focus:ring-1 focus:ring-green-600 transition-colors"
          placeholder="4"
          min="0"
          max="100"
          step="0.1"
          value="4"
        />
        <p class="mt-2 text-sm text-gray-500">Expected annual return on savings</p>
      </div>

      <!-- Calculate Button -->
      <button
        id="calculate-savings-goal"
        class="w-full px-6 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transform hover:scale-105 transition-all shadow-lg shadow-green-600/20"
      >
        Calculate Savings Goal
      </button>
    </div>
  </div>

  <!-- Results Section -->
  <div id="savings-results" class="hidden">
    <!-- Timeline Result -->
    <div id="timeline-result" class="bg-gray-50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-800 rounded-xl p-6 mb-6">
      <h4 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">Timeline to Goal</h4>
      <div class="text-center">
        <p class="text-4xl font-bold text-green-600 dark:text-green-500 mb-2">
          <span id="months-to-goal">0</span> months
        </p>
        <p class="text-gray-600 dark:text-gray-400">
          (<span id="years-to-goal">0</span> years)
        </p>
      </div>
    </div>

    <!-- Contribution Result -->
    <div id="contribution-result" class="bg-gray-50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-800 rounded-xl p-6 mb-6 hidden">
      <h4 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">Required Monthly Contribution</h4>
      <div class="text-center">
        <p id="required-contribution" class="text-4xl font-bold text-green-600 dark:text-green-500 mb-2">$0</p>
      </div>
    </div>

    <!-- Summary -->
    <div class="bg-gray-50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-800 rounded-xl p-6">
      <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Summary</h4>
      <div class="space-y-3">
        <div class="flex justify-between">
          <span class="text-gray-600 dark:text-gray-400">Target Amount:</span>
          <span id="summary-target" class="text-gray-900 dark:text-white font-semibold">$0</span>
        </div>
        <div class="flex justify-between">
          <span class="text-gray-600 dark:text-gray-400">Current Savings:</span>
          <span id="summary-current" class="text-gray-900 dark:text-white font-semibold">$0</span>
        </div>
        <div class="flex justify-between">
          <span class="text-gray-600 dark:text-gray-400">Total Contributed:</span>
          <span id="summary-contributed" class="text-gray-900 dark:text-white font-semibold">$0</span>
        </div>
        <div class="flex justify-between">
          <span class="text-gray-600 dark:text-gray-400">Interest Earned:</span>
          <span id="summary-interest" class="text-green-600 dark:text-green-500 font-semibold">$0</span>
        </div>
        <div class="border-t border-gray-300 dark:border-gray-700 pt-3 flex justify-between">
          <span class="text-gray-900 dark:text-white font-semibold">Final Amount:</span>
          <span id="summary-final" class="text-green-600 dark:text-green-500 font-bold text-lg">$0</span>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  import {
    calculateSavingsTimeline,
    calculateRequiredMonthlyContribution,
    formatCurrency,
  } from '../../lib/calculators/savings';

  let currentMode = 'timeline';
  const modeTimelineBtn = document.getElementById('mode-timeline') as HTMLButtonElement;
  const modeContributionBtn = document.getElementById('mode-contribution') as HTMLButtonElement;
  const monthlyContributionGroup = document.getElementById('monthly-contribution-group') as HTMLElement;
  const targetTimelineGroup = document.getElementById('target-timeline-group') as HTMLElement;
  const calculateBtn = document.getElementById('calculate-savings-goal') as HTMLButtonElement;
  const resultsSection = document.getElementById('savings-results') as HTMLElement;

  function setMode(mode: 'timeline' | 'contribution') {
    currentMode = mode;
    [modeTimelineBtn, modeContributionBtn].forEach((btn) => {
      btn.classList.remove('border-green-600', 'bg-gray-700');
      btn.classList.add('border-gray-300 dark:border-gray-700');
    });

    if (mode === 'timeline') {
      modeTimelineBtn.classList.add('border-green-600', 'bg-gray-700');
      monthlyContributionGroup.classList.remove('hidden');
      targetTimelineGroup.classList.add('hidden');
    } else {
      modeContributionBtn.classList.add('border-green-600', 'bg-gray-700');
      monthlyContributionGroup.classList.add('hidden');
      targetTimelineGroup.classList.remove('hidden');
    }
  }

  modeTimelineBtn.addEventListener('click', () => setMode('timeline'));
  modeContributionBtn.addEventListener('click', () => setMode('contribution'));
  setMode('timeline'); // Default

  calculateBtn.addEventListener('click', () => {
    const targetAmount = parseFloat((document.getElementById('target-amount') as HTMLInputElement).value);
    const currentSavings = parseFloat((document.getElementById('current-savings') as HTMLInputElement).value) || 0;
    const interestRate = parseFloat((document.getElementById('interest-rate') as HTMLInputElement).value) || 0;

    if (!targetAmount || targetAmount <= 0) {
      alert('Please enter a target savings amount');
      return;
    }

    if (currentMode === 'timeline') {
      const monthlyContribution = parseFloat((document.getElementById('monthly-contribution') as HTMLInputElement).value) || 0;
      if (monthlyContribution <= 0) {
        alert('Please enter a monthly contribution amount');
        return;
      }

      const result = calculateSavingsTimeline(targetAmount, currentSavings, monthlyContribution, interestRate);

      document.getElementById('months-to-goal')!.textContent = result.monthsToGoal === Infinity ? '∞' : result.monthsToGoal.toString();
      document.getElementById('years-to-goal')!.textContent = result.yearsToGoal === Infinity ? '∞' : result.yearsToGoal.toFixed(1);
      document.getElementById('summary-target')!.textContent = formatCurrency(targetAmount);
      document.getElementById('summary-current')!.textContent = formatCurrency(currentSavings);
      document.getElementById('summary-contributed')!.textContent = formatCurrency(result.totalContributed);
      document.getElementById('summary-interest')!.textContent = formatCurrency(result.totalInterest);
      document.getElementById('summary-final')!.textContent = formatCurrency(result.finalAmount);

      document.getElementById('timeline-result')!.classList.remove('hidden');
      document.getElementById('contribution-result')!.classList.add('hidden');
    } else {
      const targetMonths = parseFloat((document.getElementById('target-months') as HTMLInputElement).value);
      if (!targetMonths || targetMonths <= 0) {
        alert('Please enter a target timeline');
        return;
      }

      const requiredContribution = calculateRequiredMonthlyContribution(
        targetAmount,
        currentSavings,
        targetMonths,
        interestRate
      );

      document.getElementById('required-contribution')!.textContent = formatCurrency(requiredContribution);
      document.getElementById('summary-target')!.textContent = formatCurrency(targetAmount);
      document.getElementById('summary-current')!.textContent = formatCurrency(currentSavings);

      // Calculate final amount for summary
      const timelineResult = calculateSavingsTimeline(targetAmount, currentSavings, requiredContribution, interestRate);
      document.getElementById('summary-contributed')!.textContent = formatCurrency(timelineResult.totalContributed);
      document.getElementById('summary-interest')!.textContent = formatCurrency(timelineResult.totalInterest);
      document.getElementById('summary-final')!.textContent = formatCurrency(timelineResult.finalAmount);

      document.getElementById('timeline-result')!.classList.add('hidden');
      document.getElementById('contribution-result')!.classList.remove('hidden');
    }

    resultsSection.classList.remove('hidden');
    resultsSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  });
</script>

