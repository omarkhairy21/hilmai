---
// Financial Health Score Calculator Component
---

<div class="financial-health-calculator max-w-4xl mx-auto">
  <!-- Quiz Form -->
  <div class="bg-gray-900/50 border border-gray-800 rounded-2xl p-8 mb-8">
    <h3 class="text-2xl font-bold text-white mb-6">Assess Your Financial Health</h3>
    
    <div class="space-y-6">
      <!-- Emergency Fund -->
      <div>
        <label for="emergency-fund" class="block text-sm font-medium text-gray-300 mb-2">
          How many months of expenses do you have in your emergency fund?
        </label>
        <input
          type="number"
          id="emergency-fund"
          class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-[#d4ff2a] focus:ring-1 focus:ring-[#d4ff2a] transition-colors"
          placeholder="3"
          min="0"
          step="0.5"
          value="0"
        />
      </div>

      <!-- Debt-to-Income Ratio -->
      <div>
        <label for="dti-ratio" class="block text-sm font-medium text-gray-300 mb-2">
          What is your debt-to-income ratio? (%)
        </label>
        <input
          type="number"
          id="dti-ratio"
          class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-[#d4ff2a] focus:ring-1 focus:ring-[#d4ff2a] transition-colors"
          placeholder="30"
          min="0"
          max="100"
          step="0.1"
          value="0"
        />
        <p class="mt-2 text-sm text-gray-500">Monthly debt payments Ã· Monthly income Ã— 100</p>
      </div>

      <!-- Savings Rate -->
      <div>
        <label for="savings-rate" class="block text-sm font-medium text-gray-300 mb-2">
          What percentage of your income do you save? (%)
        </label>
        <input
          type="number"
          id="savings-rate"
          class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-[#d4ff2a] focus:ring-1 focus:ring-[#d4ff2a] transition-colors"
          placeholder="20"
          min="0"
          max="100"
          step="0.1"
          value="0"
        />
      </div>

      <!-- Credit Score -->
      <div>
        <label for="credit-score" class="block text-sm font-medium text-gray-300 mb-2">
          What is your credit score?
        </label>
        <input
          type="number"
          id="credit-score"
          class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-[#d4ff2a] focus:ring-1 focus:ring-[#d4ff2a] transition-colors"
          placeholder="700"
          min="300"
          max="850"
          step="1"
          value="600"
        />
      </div>

      <!-- Retirement Savings -->
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-2">
          Do you contribute to a retirement account (401k, IRA, etc.)?
        </label>
        <div class="grid grid-cols-2 gap-3">
          <button
            type="button"
            class="retirement-btn px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg text-white hover:border-[#d4ff2a] transition-colors"
            data-value="true"
          >
            Yes
          </button>
          <button
            type="button"
            class="retirement-btn px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg text-white hover:border-[#d4ff2a] transition-colors"
            data-value="false"
          >
            No
          </button>
        </div>
      </div>

      <!-- Insurance -->
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-2">
          Do you have adequate insurance coverage (health, life, disability)?
        </label>
        <div class="grid grid-cols-2 gap-3">
          <button
            type="button"
            class="insurance-btn px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg text-white hover:border-[#d4ff2a] transition-colors"
            data-value="true"
          >
            Yes
          </button>
          <button
            type="button"
            class="insurance-btn px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg text-white hover:border-[#d4ff2a] transition-colors"
            data-value="false"
          >
            No
          </button>
        </div>
      </div>

      <!-- Expense Tracking -->
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-2">
          Do you track your expenses regularly?
        </label>
        <div class="grid grid-cols-2 gap-3">
          <button
            type="button"
            class="tracking-btn px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg text-white hover:border-[#d4ff2a] transition-colors"
            data-value="true"
          >
            Yes
          </button>
          <button
            type="button"
            class="tracking-btn px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg text-white hover:border-[#d4ff2a] transition-colors"
            data-value="false"
          >
            No
          </button>
        </div>
      </div>

      <!-- Calculate Button -->
      <button
        id="calculate-health-score"
        class="w-full px-6 py-3 bg-[#d4ff2a] text-black font-semibold rounded-lg hover:bg-[#c5f01a] transform hover:scale-105 transition-all shadow-lg shadow-[#d4ff2a]/20"
      >
        Calculate Financial Health Score
      </button>
    </div>
  </div>

  <!-- Results Section -->
  <div id="health-results" class="hidden">
    <!-- Score Card -->
    <div class="bg-gray-900/50 border border-gray-800 rounded-xl p-8 mb-6 text-center">
      <h4 class="text-lg font-semibold text-white mb-4">Your Financial Health Score</h4>
      <p id="health-score" class="text-6xl font-bold text-[#d4ff2a] mb-2">0</p>
      <p id="health-grade" class="text-2xl font-semibold text-white mb-4">-</p>
      <div class="w-full bg-gray-800 rounded-full h-6 overflow-hidden">
        <div id="health-bar" class="h-full bg-[#d4ff2a] transition-all duration-500" style="width: 0%"></div>
      </div>
    </div>

    <!-- Breakdown -->
    <div class="bg-gray-900/50 border border-gray-800 rounded-xl p-6 mb-6">
      <h4 class="text-lg font-semibold text-white mb-4">Score Breakdown</h4>
      <div id="score-breakdown" class="space-y-3">
        <!-- Breakdown items will be populated dynamically -->
      </div>
    </div>

    <!-- Recommendations -->
    <div class="bg-[#d4ff2a]/10 border border-[#d4ff2a]/30 rounded-xl p-6">
      <h4 class="text-lg font-semibold text-white mb-3">ðŸ’¡ Recommendations</h4>
      <ul id="health-recommendations" class="space-y-2 text-gray-300">
        <!-- Recommendations will be populated dynamically -->
      </ul>
    </div>
  </div>
</div>

<script>
  import {
    calculateFinancialHealthScore,
    type FinancialHealthAnswers,
  } from '../../lib/calculators/financial-health';

  let retirementValue = false;
  let insuranceValue = false;
  let trackingValue = false;

  // Handle button selections
  document.querySelectorAll('.retirement-btn').forEach((btn) => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.retirement-btn').forEach((b) => {
        b.classList.remove('border-[#d4ff2a]', 'bg-gray-700');
        b.classList.add('border-gray-700');
      });
      btn.classList.add('border-[#d4ff2a]', 'bg-gray-700');
      retirementValue = btn.getAttribute('data-value') === 'true';
    });
  });

  document.querySelectorAll('.insurance-btn').forEach((btn) => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.insurance-btn').forEach((b) => {
        b.classList.remove('border-[#d4ff2a]', 'bg-gray-700');
        b.classList.add('border-gray-700');
      });
      btn.classList.add('border-[#d4ff2a]', 'bg-gray-700');
      insuranceValue = btn.getAttribute('data-value') === 'true';
    });
  });

  document.querySelectorAll('.tracking-btn').forEach((btn) => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.tracking-btn').forEach((b) => {
        b.classList.remove('border-[#d4ff2a]', 'bg-gray-700');
        b.classList.add('border-gray-700');
      });
      btn.classList.add('border-[#d4ff2a]', 'bg-gray-700');
      trackingValue = btn.getAttribute('data-value') === 'true';
    });
  });

  // Set defaults
  document.querySelectorAll('.retirement-btn[data-value="false"]')[0]?.click();
  document.querySelectorAll('.insurance-btn[data-value="false"]')[0]?.click();
  document.querySelectorAll('.tracking-btn[data-value="false"]')[0]?.click();

  const calculateBtn = document.getElementById('calculate-health-score') as HTMLButtonElement;
  const resultsSection = document.getElementById('health-results') as HTMLElement;

  calculateBtn.addEventListener('click', () => {
    const answers: FinancialHealthAnswers = {
      emergencyFundMonths: parseFloat((document.getElementById('emergency-fund') as HTMLInputElement).value) || 0,
      debtToIncomeRatio: parseFloat((document.getElementById('dti-ratio') as HTMLInputElement).value) || 0,
      savingsRate: parseFloat((document.getElementById('savings-rate') as HTMLInputElement).value) || 0,
      creditScore: parseFloat((document.getElementById('credit-score') as HTMLInputElement).value) || 600,
      hasRetirementSavings: retirementValue,
      hasInsurance: insuranceValue,
      tracksExpenses: trackingValue,
    };

    const result = calculateFinancialHealthScore(answers);

    // Update score
    document.getElementById('health-score')!.textContent = result.score.toString();
    document.getElementById('health-grade')!.textContent = result.grade;
    document.getElementById('health-bar')!.style.width = `${result.score}%`;

    // Update breakdown
    const breakdownDiv = document.getElementById('score-breakdown')!;
    breakdownDiv.innerHTML = result.breakdown
      .map(
        (item) => `
      <div class="flex items-center justify-between">
        <span class="text-gray-300">${item.category}</span>
        <div class="flex items-center gap-3">
          <div class="w-32 bg-gray-800 rounded-full h-2 overflow-hidden">
            <div class="h-full bg-[#d4ff2a]" style="width: ${item.percentage}%"></div>
          </div>
          <span class="text-white font-semibold w-12 text-right">${item.score}/${item.maxScore}</span>
        </div>
      </div>
    `
      )
      .join('');

    // Update recommendations
    const recommendationsList = document.getElementById('health-recommendations')!;
    recommendationsList.innerHTML = result.recommendations
      .map((rec) => `<li class="flex items-start gap-2"><span class="text-[#d4ff2a] mt-1">â€¢</span><span>${rec}</span></li>`)
      .join('');

    resultsSection.classList.remove('hidden');
    resultsSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  });
</script>

